<% if ga_enabled? %>
  <script>
    document.addEventListener('turbolinks:load', function() {
      if (typeof gtag !== 'undefined') {
        console.log('GTAG is defined');
        <% if user_id = try_spree_current_user.try(:id) %>
          gtag('config', '<%= ga_tracker.analytics_id %>', {
            'user_id': '<%= user_id %>',
            page_location: event.data.url,
            page_path: event.srcElement.location.pathname,
            page_title: event.srcElement.title
          });
          console.log('USER is defined');
        <% else %>
          gtag('config', '<%= ga_tracker.analytics_id %>', {
            page_location: event.data.url,
            page_path: event.srcElement.location.pathname,
            page_title: event.srcElement.title
          });
          console.log('USER is not defined');
        <% end %>
      }
    });
  </script>
<% end %>
